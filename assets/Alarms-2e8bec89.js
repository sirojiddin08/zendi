import{_ as ge,b as y,c as v,v as ne,p as ye,q as fe,g as t,A as _e,u as he,B as ve,r as a,w as T,z as be,o as xe,f as E,k as ke,l as we,i as h,n as B,F as ee,h as Se,t as u,j as te,G as Ee,I as j,S as Be,a as Ce}from"./index-aae41fd2.js";import{l as Le,u as Ie,T as ze}from"./2-61298274.js";const Te=w=>(ye("data-v-ff2dacb8"),w=w(),fe(),w),$e=Te(()=>t("i",{class:"fas fa-bell"},null,-1)),je=[$e],Pe={__name:"Pulse",props:{bgColor:{type:Array,required:!0,default:["#8a82fb","#407ed7"]}},setup(w){const C=w;return(se,P)=>(y(),v("div",{class:"pulse",style:ne({"--first-bg-color":C.bgColor[0],"--gradient-bg":`linear-gradient(${C.bgColor[0]}, ${C.bgColor[1]})`})},je,4))}},oe=ge(Pe,[["__scopeId","data-v-ff2dacb8"]]);const Ae={class:"split-pane mapSection m-0 p-0 gap-2 align-items-center"},We={class:"card p-1",style:{position:"relative",overflow:"hidden"}},Me={class:"layer-cog",style:{top:"140px"}},Fe={class:"layers"},Je={class:"text-xs layer-name"},De=t("div",{id:"map",class:"p-1",style:{height:"88vh",position:"relative"}},null,-1),Ve=t("i",{class:"pi pi-arrows-h"},null,-1),qe=[Ve],Ne={class:"card p-1 m-0 rightBar",style:{"overflow-y":"auto",height:"89vh"}},Re=["onClick"],Oe={class:"mt-2"},He={key:0,class:"pb-1 m-0"},Ue={key:1,class:"pb-1 m-0"},Xe={class:"p-0 m-0"},Ge={class:"px-0 pt-2 m-0"},Ke={class:"mb-0 pb-0"},Ze={class:"font-bold whitespace-nowrap mb-0 pb-0 text-2xl"},Qe=t("div",{id:"playWind",style:{width:"1110px",height:"670px",display:"none"}},null,-1),Ye=t("div",{class:"rounded",id:"offline_bg"},[t("span",null,"Kamera offline!")],-1),et={class:"items m-2 mt-6 flex"},tt={class:"grid",style:{width:"180px","margin-left":"-0.4rem"}},ot={class:"col-4 p-0"},nt=t("i",{class:"pi pi-window-maximize"},null,-1),st=[nt],lt=t("div",{class:"col-4 p-0 unmute",style:{display:"none"}},[t("button",{class:"o-button o-button-success",type:"button"},[t("i",{class:"pi pi-volume-up"})])],-1),it=t("div",{class:"col-4 p-0 mute"},[t("button",{class:"o-button o-button-danger",type:"button"},[t("i",{class:"pi pi-volume-off"})])],-1),at={class:"col-4 p-0"},ct=t("i",{class:"pi pi-camera"},null,-1),dt=[ct],rt={class:"grid w-full",style:{"margin-left":"30px","font-size":"18px"}},ut={class:"xl:col-9 md:col-6 p-0 mt-1 pl-2"},pt={style:{display:"inline"}},mt={class:"ml-2"},gt={class:"xl:col-3 md:col-6 p-0"},yt={for:"camera"},ft={key:0,class:"flex items-center"},_t={key:1},ht={class:"flex items-center"},vt="pk.eyJ1Ijoic2lyb2ppZGRpbjc2NzkiLCJhIjoiY2x3OTh5ZThtMDE3dTJrbThmaXFjMHFubyJ9.VB1O3PP2F8aSNjeuhn-ebQ",kt={__name:"Alarms",setup(w){const C=_e("socket"),{t:se,locale:P}=he(),le=ve(),ie=window.location.search;new URLSearchParams(ie),a(0);let o;a(!1),a();const A=a(),I=a(!1),b=a(),D=a(!0);let V;a(.1),a(17.5);const W=a();a(!0),a(!1);let q=0;const g=a({img:"standard"}),ae=a([{img:"standard"},{img:"satellite-streets-v12"},{img:"satellite-v9"},{img:"navigation-day-v1"},{img:"navigation-night-v1"},{img:"light-v11"},{img:"dark-v11"},{img:"streets-v12"},{img:"outdoors-v12"}]);a({}),a(!1),a([{breakpoint:"1024px",numVisible:5},{breakpoint:"960px",numVisible:4},{breakpoint:"768px",numVisible:3},{breakpoint:"560px",numVisible:1}]);let p;a([{uz:"Onlayn",oz:"Онлайн",ru:"Онлайн",value:"1"},{uz:"Oflayn",oz:"Офлайн",ru:"Офлайн",value:"0"}]);const N=(e,n)=>{const s=parseFloat(e),c=parseFloat(n);if(isNaN(s)||isNaN(c)){console.error(`Invalid coordinates: lon=${e}, lat=${n}`);return}o&&o.flyTo({center:[s,c],zoom:18,speed:5,curve:.8,essential:!0})};T(()=>le.isCollapsed,()=>{o&&setTimeout(()=>{o.resize()},400)});const f=a([]),L=new Map;function R(e){switch(e){case 0:return["red","#ff5733"];case 1:return["green","#5bff47"];default:return["yellow","#f9ec8f"]}}C.on("alarm",e=>{O(e)});function O(e){if(!o)return;const n=f.value.find(d=>d.object_id===e.object_id);if(n&&n.state<e.state){const d=f.value.findIndex(i=>i.object_id===n.object_id);if(d!==-1){const i=L.get(n.object_id);i&&(i.marker.remove(),i.vueApp.unmount(),L.delete(n.object_id)),f.value[d].state=e==null?void 0:e.state}}else f.value.unshift(e);const s=document.createElement("div");s.style.cursor="pointer";const c=R(e.state),m=Be(oe,{bgColor:c});m.mount(s);const r=new mapboxgl.Marker(s).setLngLat([e.lon,e.lat]).addTo(o);s.addEventListener("click",()=>N(e.lon,e.lat)),L.set(e.object_id,{marker:r,vueApp:m}),e.state===2&&setTimeout(()=>{const d=f.value.findIndex(i=>i.object_id===e.object_id);if(d!==-1){const i=L.get(e.object_id);i&&(i.marker.remove(),i.vueApp.unmount(),L.delete(e.object_id)),f.value.splice(d,1)}},3e4)}async function ce(e){try{const{data:n}=await Ce.get("/alarm");f.value=[],n.forEach(s=>{O(s)})}catch(n){console.error("Error fetching alarms:",n)}}const x=a(null),H=a(null);let M=!1,U=0,X=0,z;const de=e=>{M=!0,U=e.clientX,X=x.value.getBoundingClientRect().width,document.addEventListener("mousemove",F),document.addEventListener("mouseup",J)},F=e=>{if(M){const n=e.clientX-U,s=X+n;x.value.style.width=`${s}px`,H.value.style.width=`calc(100% - ${s}px - 5px)`}},J=()=>{M=!1,document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",J)};be(()=>{document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",J),z&&x.value&&z.unobserve(x.value)});const re=()=>{o&&o.resize()};xe(async()=>{const e=async()=>{const n=["https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js","https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"];for(const s of n)await new Promise((c,m)=>{const r=document.createElement("script");r.src=s,r.onload=c,r.onerror=()=>m(new Error(`Failed to load script ${s}`)),document.head.appendChild(r)})};T(()=>g.value,()=>{e().then(async()=>{mapboxgl.accessToken=vt,q=0,o=new mapboxgl.Map({container:"map",style:`mapbox://styles/mapbox/${g.value.img}`,center:[64.0202744,41.6384327],zoom:5.5,pitch:0,bearing:q,antialias:!0});const n=new MapboxGeocoder({accessToken:mapboxgl.accessToken,marker:!1,placeholder:"Search Address",mapboxgl});o.addControl(new mapboxgl.NavigationControl),o.addControl(n,"top-right"),document.querySelector(".mapboxgl-ctrl-geocoder--input").addEventListener("input",s=>{W.value=s.target.value,W.value?document.querySelector(".mapboxgl-ctrl-geocoder").style.width="250px":document.querySelector(".mapboxgl-ctrl-geocoder").style.width="35px"}),document.querySelector(".mapboxgl-ctrl-geocoder--button").addEventListener("click",()=>{W.value="",document.querySelector(".mapboxgl-ctrl-geocoder").style.width="35px"}),o.loadImage(Le,function(s,c){if(s)throw s;o.addImage("location_green_icon",c)}),V=window.tb=new Threebox(o,o.getCanvas().getContext("webgl"),{defaultLights:!0}),o.on("style.load",()=>{if(g.value.img!=="standard")return;o.style.getFragmentStyle("basemap").options.get("lightPreset");const m="night";let r=document.getElementById(m);r.classList.add("selected"),o.setConfigProperty("basemap","lightPreset",m),document.querySelectorAll(".map-button").forEach(d=>{d.addEventListener("click",()=>{o.setConfigProperty("basemap","lightPreset",d.id),r&&r.classList.remove("selected"),d.classList.add("selected"),r=d})}),console.log(o.getStyle().layers)}),o.on("load",()=>{var m;if(o.setFog(null),g.value.img!=="standard"&&g.value.img!=="satellite-v9"){const d=(m=o.getStyle().layers.find(i=>i.type==="symbol"&&i.layout["text-field"]))==null?void 0:m.id;o.addSource("mapbox-dem",{type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512,maxzoom:14}),o.setTerrain({source:"mapbox-dem",exaggeration:1.5}),o.addLayer({id:"sky",type:"sky",paint:{"sky-type":"atmosphere","sky-atmosphere-sun":[0,0],"sky-atmosphere-sun-intensity":15}}),o.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:10,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],15,0,15.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],15,0,15.05,["get","min_height"]],"fill-extrusion-opacity":.8}},d)}o.addLayer({id:"custom-threebox-model",type:"custom",renderingMode:"3d",onAdd:function(){},render:function(){V.update(),o.getZoom()}}),o.addSource("uzbekistan",{type:"geojson",data:Ie}),o.addLayer({id:"uzbekistan-boundaries",type:"line",source:"uzbekistan",layout:{},paint:{"line-color":"#00E9EA","line-width":2}}),o.addLayer({id:"uzbekistan-fill",type:"fill",source:"uzbekistan",layout:{},paint:{"fill-color":"#EFECDA","fill-opacity":0}}),o.addSource("traffic",{type:"vector",url:"mapbox://mapbox.mapbox-traffic-v1"}),o.addLayer({id:"traffic",type:"line",source:"traffic","source-layer":"traffic",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["match",["get","congestion"],"low","#06D001","moderate","#FF8F00","heavy","#FE0000","severe","#212529","#000000"],"line-width":["interpolate",["linear"],["zoom"],9,1,16,6],"line-opacity":1}});const s=document.createElement("button");s.innerHTML="2D",s.style.fontWeight="800",s.style.color="#000",s.onclick=()=>{o.easeTo({pitch:0,bearing:0})};const c=document.createElement("button");if(c.innerHTML="3D",c.style.fontWeight="800",c.style.color="#000",c.onclick=()=>{o.easeTo({pitch:60,bearing:0})},D.value){D.value=!1;class r{onAdd(i){return this._map=i,this._container=document.querySelector(".mapboxgl-ctrl-group"),this._container.appendChild(s),this._container.appendChild(c),this.updateButtons(),i.on("pitchend",this.updateButtons.bind(this)),i.on("moveend",this.updateButtons.bind(this)),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map.off("pitchend",this.updateButtons.bind(this)),this._map.off("moveend",this.updateButtons.bind(this)),this._map=void 0}updateButtons(){this._map.getPitch()===0?(s.style.display="none",c.style.display="block"):(s.style.display="block",c.style.display="none")}}o.addControl(new r,"top-right")}}),await ce()}).catch(n=>{console.error("Error loading scripts:",n)})},{deep:!0,immediate:!0}),z=new ResizeObserver(()=>{re()}),x.value&&z.observe(x.value)});var G=0;let k=!1;T(()=>I.value,()=>{I.value||(document.querySelector(".mute").style.display="block",document.querySelector(".unmute").style.display="none",k&&(p.JS_Stop(0),k=!1))}),T(()=>b.value,()=>{var e;(e=b.value)!=null&&e.code&&(j(()=>{document.getElementById("offline_bg").style.display="flex",document.getElementById("offline_bg").innerHTML="",document.getElementById("offline_bg").classList.add("camera_loading"),document.getElementById("playWind").style.display="none",document.querySelector(".mute").style.display="block",document.querySelector(".unmute").style.display="none"}),k?p.JS_Stop(0).then(function(){console.log("stop success"),k=!1,j(K(b.value))},function(){console.log("stop failed")}):j(K(b.value)))});function K(e){j(()=>{p=new JSPlugin({szId:"playWind",iType:2,iWidth:1110,iHeight:670,iMaxSplit:4,iCurrentSplit:2,szBasePath:"/src",oStyle:{border:"#343434",borderSelect:"transparent",background:"#000 url('/src/assets/online.svg') no-repeat center center;"}}),$(".mute").click(function(n){var s=p.JS_OpenSound(0);if(s==0)console.log("Ушбу камерада овоз бор, уни ёқишни тасдиқлайсизми?"),$(".mute").hide(),$(".unmute").show();else{alert("Ушбу камерада овоз йўқ");return}}),$(".unmute").click(function(n){$(".mute").show(),$(".unmute").hide(),pe()}),k?p.JS_Stop(0).then(function(){console.log("stop success"),k=!1,Q(1),(e==null?void 0:e.code)==0?(document.getElementById("offline_bg").style.display="none",document.getElementById("playWind").style.display="block",document.getElementById("playWind").style.width="1110px",document.getElementById("playWind").style.height="670px",Z(e==null?void 0:e.url,0)):(document.getElementById("offline_bg").style.display="flex",document.getElementById("offline_bg").innerHTML="Kamera offline",document.getElementById("offline_bg").classList.remove("camera_loading"),document.getElementById("playWind").style.display="none")},function(){console.log("stop failed")}):(Q(1),(e==null?void 0:e.code)==0?(document.getElementById("offline_bg").style.display="none",document.getElementById("playWind").style.display="block",document.getElementById("playWind").style.width="1110px",document.getElementById("playWind").style.height="670px",Z(e==null?void 0:e.url,0)):(document.getElementById("offline_bg").style.display="flex",document.getElementById("offline_bg").innerHTML="Kamera offline",document.getElementById("offline_bg").classList.remove("camera_loading"),document.getElementById("playWind").style.display="none"))})}function Z(e,n){p.JS_Play(e,{playURL:e},n).then(function(){console.log("realplay success"),n==0&&(k=!0)},function(){console.log("realplay failed")})}function Q(e){p.JS_ArrangeWindow(e)}function ue(e){p.JS_CapturePicture(G,"img",e).then(function(){console.log("CapturePicture success")},function(){console.log("CapturePicture failed")})}function pe(){p.JS_CloseSound(G)}function me(){p.JS_FullScreenDisplay(!0)}return window.onresize=function(){p==null||p.JS_Resize(1110,670),document.getElementById("playWind").style.width="1110px",document.getElementById("playWind").style.height="670px"},(e,n)=>{var Y;const s=E("Image"),c=E("SelectButton"),m=E("Badge"),r=E("Dropdown"),d=E("FloatLabel"),i=E("Dialog");return y(),v(ee,null,[t("div",Ae,[t("div",{class:"col-9 p-0 m-0 pane-left",ref_key:"mapContainer",ref:x},[t("div",We,[t("div",Me,[((Y=g.value)==null?void 0:Y.img)=="standard"?(y(),ke(ze,{key:0})):we("",!0),t("div",Fe,[h(s,{src:`/demo/images/${g.value.img}.png`,alt:""},null,8,["src"]),h(c,{modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=l=>g.value=l),options:ae.value},{option:B(l=>[t("div",null,[h(s,{src:`/demo/images/${l.option.img}.png`,alt:""},null,8,["src"]),t("div",Je,u(e.$t(l.option.img)),1)])]),_:1},8,["modelValue","options"])])]),De])],512),t("div",{class:"resizer card p-2 h-full m-0",onMousedown:de},qe,32),t("div",{class:"col p-0 m-0 pane-right",ref_key:"rightPane",ref:H},[t("div",Ne,[(y(!0),v(ee,null,Se(f.value,l=>{var _;return y(),v("div",{key:l,onClick:S=>N(l.lon,l.lat),class:"card flex gap-4 m-1 p-3",style:{cursor:"pointer"}},[t("div",Oe,[h(oe,{"bg-color":R(l.state)},null,8,["bg-color"])]),t("div",null,[(_=l.region)!=null&&_.uz?(y(),v("p",He,u(l.region[te(P)]),1)):(y(),v("p",Ue,u(l.region),1)),t("h5",Xe,u(l.name),1),t("p",Ge,u(l.address),1)])],8,Re)}),128))])],512)]),h(i,{visible:I.value,"onUpdate:visible":n[4]||(n[4]=l=>I.value=l),modal:!0,breakpoints:{"960px":"75vw"},style:ne([{width:"60vw"},{"z-index":"1000"}])},{header:B(()=>{var l,_,S;return[t("h3",Ke,u((_=(l=A.value)==null?void 0:l.object[0])==null?void 0:_.name[te(P)]),1),t("p",Ze,u(e.$t("current_camera"))+": "+u((S=b.value)==null?void 0:S.comment),1)]}),default:B(()=>[t("div",null,[Qe,Ye,t("div",et,[t("div",tt,[t("div",ot,[t("button",{class:"o-button o-button-secondary",type:"button",onClick:n[1]||(n[1]=l=>me())},st)]),lt,it,t("div",at,[t("button",{class:"o-button o-button-warning",type:"button",onClick:n[2]||(n[2]=l=>ue("JPEG"))},dt)])]),t("div",rt,[t("div",ut,[t("p",pt,u(e.$t("all_cameras"))+":",1),t("b",mt,u(A.value.camInfo.length),1)]),t("div",gt,[h(d,{class:"w-full"},{default:B(()=>[t("label",yt,u(e.$t("camera")),1),h(r,{class:"w-full",inputId:"camera",modelValue:b.value,"onUpdate:modelValue":n[3]||(n[3]=l=>b.value=l),options:A.value.camInfo,optionLabel:"comment",placeholder:e.$t("select")},{value:B(l=>{var _,S;return[(_=l.value)!=null&&_.comment?(y(),v("div",ft,[t("div",null,u((S=l.value)==null?void 0:S.comment),1)])):(y(),v("span",_t,u(l.placeholder),1))]}),option:B(l=>[t("div",ht,[t("div",null,[h(m,{class:"mb-1",severity:l.option.code==0?"success":"danger"},null,8,["severity"]),Ee(" "+u(l.option.comment),1)])])]),_:1},8,["modelValue","options","placeholder"])]),_:1})])])])])]),_:1},8,["visible"])],64)}}};export{kt as default};
