import{m as ye,u as be,r as n,o as ge,a as c,w as $e,f as h,b as $,c as w,g as t,i,n as u,G as _,t as d,j as f,l as q,E as D}from"./index-aae41fd2.js";const we={class:"grid"},Ve={class:"col-12"},qe={class:"card"},Ce=t("i",{class:"pi pi-upload mr-1"},null,-1),ke={class:"grid gap-3 ml-2 py-3"},De={class:"col-3 p-0",style:{width:"180px"}},Ue={for:"region",class:"mb-3"},Me={class:"col-3 p-0",style:{width:"180px"}},Se={for:"districts",class:"mb-3"},Te={class:"col-3 p-0",style:{width:"180px"}},Ie={for:"tqm",class:"mb-3"},Ne={class:"col-3 p-0",style:{width:"180px"}},Be={for:"main_or_additional",class:"mb-3"},Fe={class:"col-3 p-0",style:{width:"180px"}},ze={for:"smena",class:"mb-3"},Ae={class:"col-3 p-0",style:{width:"180px"}},je={for:"date",class:"mb-3"},Ee=t("i",{class:"pi pi-plus mr-1"},null,-1),Oe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Pe={class:"m-0"},Re=t("i",{class:"pi pi-search"},null,-1),Ge={class:"text-center"},He=t("span",{class:"p-column-title"},"structure",-1),Le=t("span",{class:"p-column-title"},"tqm",-1),Qe=t("span",{class:"p-column-title"},"plate_number",-1),We=t("span",{class:"p-column-title"},"main_or_additional",-1),Ye=t("span",{class:"p-column-title"},"body_cam",-1),Je=t("span",{class:"p-column-title"},"smena",-1),Ke=t("span",{class:"p-column-title"},"date",-1),Xe=["onClick"],Ze=t("i",{class:"pi pi-pencil"},null,-1),xe=[Ze],ea=["onClick"],aa=t("i",{class:"pi pi-trash mr-1"},null,-1),ta=[aa],la={class:"field grid"},oa={class:"col-6"},sa={for:"region",class:"mb-3"},ia={class:"col-6"},da={for:"discity"},na=t("span",{style:{color:"#ff5050"}},"*",-1),ua={key:0,class:"p-invalid"},ra={class:"field grid"},ca={class:"col-12"},_a={for:"tqm"},ma=t("span",{style:{color:"#ff5050"}},"*",-1),va={key:0,class:"p-invalid"},pa={class:"field grid"},ha={class:"col-6"},fa={for:"cars"},ya=t("span",{style:{color:"#ff5050"}},"*",-1),ba={key:0,class:"p-invalid"},ga={class:"col-6"},$a={for:"body_cam_id"},wa=t("span",{style:{color:"#ff5050"}},"*",-1),Va={key:0,class:"p-invalid"},qa={class:"field grid"},Ca={class:"col-6"},ka={for:"main_or_additional"},Da=t("span",{style:{color:"#ff5050"}},"*",-1),Ua={key:0,class:"p-invalid"},Ma={class:"col-6"},Sa={for:"smena"},Ta=t("span",{style:{color:"#ff5050"}},"*",-1),Ia={key:0,class:"p-invalid"},Na={class:"flex align-items-center justify-content-center"},Ba=t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Fa={key:0},ja={__name:"CurrentOperativeGroup",setup(za){const C=ye(),{t:m,locale:p}=be(),V=n(!1),U=n(!1),l=n({});n(null);const Q=n(null),y=n(!1),k=n(""),N=n([]),B=n([]),F=n([]),x=n(),z=n(),A=n(),j=n(),E=n(),O=n(),P=n(),S=n(!1),W=n([]);ge(async()=>{await M();const e=await c.get("/references/regions"),o=await c.get("/references/distcity"),r=await c.get("/references/tqm"),b=await c.get("/users/cars"),v=await c.get("/gps/main_or_additional"),H=await c.get("/gps/smena"),L=await c.get("/references/body-camera");N.value=await e.data,B.value=await o.data,z.value=await o.data,F.value=r.data,A.value=r.data,x.value=b.data,j.value=b.data,E.value=L.data,O.value=v.data.data,P.value=H.data.data});const T=n({global:{value:null,matchMode:D.CONTAINS},name:{value:null,matchMode:D.STARTS_WITH},"country.name":{value:null,matchMode:D.STARTS_WITH},representative:{value:null,matchMode:D.IN},status:{value:null,matchMode:D.EQUALS},verified:{value:null,matchMode:D.EQUALS}}),s=n({q:"",limit:10,page:0,region:"",distcity:"",tech_center_id:"",main_or_additional:"",smena:"",date:new Date});function ee(e){const o=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),b=String(e.getDate()).padStart(2,"0");return`${o}-${r}-${b}`}JSON.parse(localStorage.getItem("userData"));async function M(e){var o;try{S.value=!0;let b=`/operative_group?date=${ee(s.value.date)}`,v=[];((o=s.value.q)==null?void 0:o.length)>2&&v.push(`q=${s.value.q}`),s.value.region&&v.push(`region=${s.value.region}`),s.value.distcity&&v.push(`distcity=${s.value.distcity}`),s.value.tech_center_id&&v.push(`tech_center_id=${s.value.tech_center_id}`),s.value.main_or_additional&&v.push(`main_or_additional=${s.value.main_or_additional}`),s.value.smena&&v.push(`smena=${s.value.smena}`),v.length>0&&(b+="&"+v.join("&")),W.value=await c.get(b),S.value=!1}catch{S.value=!1}}function ae(e){s.value.region=e,s.value.distcity="",s.value.tech_center_id="",ie(e),Y()}function te(e){s.value.distcity=e,s.value.tech_center_id="",Y()}function le(e){k.value=e,l.value.structure_id="",l.value.tech_center_id="",l.value.car_id="",l.value.body_cam_id="",de(e),J(),R(),G()}function oe(e){l.value.structure_id=e,l.value.tech_center_id="",l.value.car_id="",l.value.body_cam_id="",J(),R(),G()}function se(e){l.value.tech_center_id=e,l.value.car_id="",l.value.body_cam_id="",R(),G()}async function ie(e){const o=await c.get(`/references/distcity?region=${e}`);B.value=await o.data}async function Y(e){const o=await c.get(`/references/tqm?region=${s.value.region}&distcity=${s.value.distcity}`);F.value=await o.data}async function de(e){const o=await c.get(`/references/distcity?region=${e}`);z.value=await o.data}async function J(){const e=await c.get(`/references/tqm?region=${k.value}&distcity=${l.value.structure_id}`);A.value=await e.data}async function R(){const e=await c.get(`/users/cars?region=${k.value}&distcity=${l.value.structure_id}&tqm=${l.value.tech_center_id}`);j.value=await e.data}async function G(){const e=await c.get(`/references/body-camera?region=${k.value}&distcity=${l.value.structure_id}&tqm=${l.value.tech_center_id}`);E.value=await e.data}const ne=()=>{l.value={structure_id:"",tech_center_id:"",car_id:"",main_or_additional:"",body_cam_id:null,smena:""},y.value=!1,V.value=!0};$e(()=>s.value,async()=>{M()},{deep:!0});const ue=()=>{V.value=!1,y.value=!1},re=async()=>{if(y.value=!0,!!l.value.structure_id&&l.value.tech_center_id&&l.value.car_id&&l.value.main_or_additional&&l.value.body_cam_id&&l.value.smena)if(l.value.id)try{await c.put(`/operative_group/${l.value.id}`,l.value),M(l.value.id),C.add({severity:"success",summary:m("status"),detail:m("success"),life:3e3}),V.value=!1,l.value={}}catch{C.add({severity:"error",summary:m("status"),detail:m("error"),life:3e3})}else try{await c.post("/operative_group",l.value),M(),C.add({severity:"success",summary:m("status"),detail:m("success"),life:3e3}),V.value=!1,l.value={}}catch{C.add({severity:"error",summary:m("status"),detail:m("error"),life:3e3})}},ce=async e=>{const o=await c.get(`/operative_group/${e.id}`);l.value=o.data,V.value=!0},_e=e=>{l.value.id=e,U.value=!0},me=async()=>{try{await c.delete(`/operative_group/${l.value.id}`),U.value=!1,l.value={},C.add({severity:"success",summary:m("status"),detail:m("success"),life:3e3}),M()}catch{C.add({severity:"error",summary:m("status"),detail:m("error"),life:3e3})}},ve=()=>{Q.value.exportCSV()};return(e,o)=>{var X,Z;const r=h("v-select"),b=h("Calendar"),v=h("Toolbar"),H=h("InputIcon"),L=h("InputText"),pe=h("IconField"),g=h("Column"),he=h("DataTable"),I=h("Button"),K=h("Dialog");return $(),w("div",we,[t("div",Ve,[t("div",qe,[i(v,{class:"mb-4"},{start:u(()=>[t("button",{class:"o-button o-button-secondary mr-2",onClick:o[0]||(o[0]=a=>ve(a))},[Ce,_(" "+d(e.$t("save")),1)]),t("div",ke,[t("div",De,[t("label",Ue,d(e.$t("regions")),1),i(r,{"onUpdate:modelValue":[ae,o[1]||(o[1]=a=>s.value.region=a)],id:"region",modelValue:s.value.region,options:N.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"])]),t("div",Me,[t("label",Se,d(e.$t("districts")),1),i(r,{"onUpdate:modelValue":[te,o[2]||(o[2]=a=>s.value.distcity=a)],id:"districts",modelValue:s.value.distcity,options:B.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"])]),t("div",Te,[t("label",Ie,d(e.$t("tqm")),1),i(r,{id:"tqm",modelValue:s.value.tech_center_id,"onUpdate:modelValue":o[3]||(o[3]=a=>s.value.tech_center_id=a),options:F.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"])]),t("div",Ne,[t("label",Be,d(e.$t("main_or_additional")),1),i(r,{id:"main_or_additional",modelValue:s.value.main_or_additional,"onUpdate:modelValue":o[4]||(o[4]=a=>s.value.main_or_additional=a),options:O.value,label:"name",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"])]),t("div",Fe,[t("label",ze,d(e.$t("smena")),1),i(r,{id:"smena",modelValue:s.value.smena,"onUpdate:modelValue":o[5]||(o[5]=a=>s.value.smena=a),options:P.value,label:"name",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"])]),t("div",Ae,[t("label",je,d(e.$t("date")),1),i(b,{id:"date",modelValue:s.value.date,"onUpdate:modelValue":o[6]||(o[6]=a=>s.value.date=a),showIcon:!0},null,8,["modelValue"])])])]),end:u(()=>[t("button",{class:"o-button o-button-success",onClick:ne},[Ee,_(d(e.$t("add")),1)])]),_:1}),i(he,{ref_key:"dt",ref:Q,filters:T.value,"onUpdate:filters":o[8]||(o[8]=a=>T.value=a),value:(Z=(X=W.value)==null?void 0:X.data)==null?void 0:Z.data,paginator:"",rows:10,dataKey:"id",loading:S.value,globalFilterFields:["id","structure.uz","structure.oz","structure.ru","tqm.uz","tqm.oz","tqm.ru","plate_number","body_cam","smena"]},{header:u(()=>[t("div",Oe,[t("h5",Pe,d(e.$t("current_operative_group")),1),i(pe,null,{default:u(()=>[i(H,null,{default:u(()=>[Re]),_:1}),i(L,{modelValue:T.value.global.value,"onUpdate:modelValue":o[7]||(o[7]=a=>T.value.global.value=a),placeholder:e.$t("search")},null,8,["modelValue","placeholder"])]),_:1})])]),empty:u(()=>[t("div",Ge,d(e.$t("no_data")),1)]),default:u(()=>[i(g,{header:e.$t("â„–"),headerStyle:"width:14px;"},{body:u(a=>[_(d(a.index+1),1)]),_:1},8,["header"]),i(g,{field:"structure",header:e.$t("structure"),sortable:!0},{body:u(a=>[He,_(" "+d(a.data.structure[f(p)]),1)]),_:1},8,["header"]),i(g,{field:"tqm",header:e.$t("tqm"),sortable:!1},{body:u(a=>[Le,_(" "+d(a.data.tqm[f(p)]),1)]),_:1},8,["header"]),i(g,{field:"plate_number",header:e.$t("plate_number"),sortable:!0},{body:u(a=>[Qe,_(" "+d(a.data.plate_number),1)]),_:1},8,["header"]),i(g,{field:"main_or_additional",header:e.$t("main_or_additional"),sortable:!1},{body:u(a=>[We,_(" "+d(a.data.main_or_additional[f(p)]),1)]),_:1},8,["header"]),i(g,{field:"body_cam",header:e.$t("body_cam"),sortable:!1},{body:u(a=>[Ye,_(" "+d(a.data.body_cam),1)]),_:1},8,["header"]),i(g,{field:"smena",header:e.$t("smena"),sortable:!1},{body:u(a=>[Je,_(" "+d(a.data.smena[f(p)]),1)]),_:1},8,["header"]),i(g,{field:"date",header:e.$t("date"),sortable:!0},{body:u(a=>[Ke,_(" "+d(a.data.date),1)]),_:1},8,["header"]),i(g,{header:e.$t("actions"),headerStyle:"min-width:10rem;"},{body:u(a=>[t("button",{class:"o-button o-button-warning mr-2",onClick:fe=>ce(a.data)},xe,8,Xe),t("button",{class:"o-button o-button-danger",onClick:fe=>_e(a.data.id)},ta,8,ea)]),_:1},8,["header"])]),_:1},8,["filters","value","loading"]),i(K,{visible:V.value,"onUpdate:visible":o[16]||(o[16]=a=>V.value=a),style:{width:"750px"},header:l.value.id?e.$t("edit"):e.$t("add"),modal:!0,class:"p-fluid"},{footer:u(()=>[i(I,{label:e.$t("cancel"),icon:"pi pi-times",class:"text-red-400",text:"",onClick:ue},null,8,["label"]),i(I,{label:e.$t("save"),icon:"pi pi-check",text:"",onClick:re},null,8,["label"])]),default:u(()=>[t("div",la,[t("div",oa,[t("label",sa,d(e.$t("regions")),1),i(r,{"onUpdate:modelValue":[le,o[9]||(o[9]=a=>k.value=a)],id:"region",modelValue:k.value,options:N.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"])]),t("div",ia,[t("label",da,[_(d(e.$t("districts")),1),na]),i(r,{"onUpdate:modelValue":[oe,o[10]||(o[10]=a=>l.value.structure_id=a)],id:"discity",modelValue:l.value.structure_id,options:z.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"]),y.value&&!l.value.structure_id?($(),w("small",ua,d(e.$t("field_required")),1)):q("",!0)])]),t("div",ra,[t("div",ca,[t("label",_a,[_(d(e.$t("tqm")),1),ma]),i(r,{"onUpdate:modelValue":[se,o[11]||(o[11]=a=>l.value.tech_center_id=a)],id:"tqm",modelValue:l.value.tech_center_id,options:A.value,label:f(p),reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","label","reduce","placeholder"]),y.value&&!l.value.tech_center_id?($(),w("small",va,d(e.$t("field_required")),1)):q("",!0)])]),t("div",pa,[t("div",ha,[t("label",fa,[_(d(e.$t("cars")),1),ya]),i(r,{id:"cars",modelValue:l.value.car_id,"onUpdate:modelValue":o[12]||(o[12]=a=>l.value.car_id=a),options:j.value,label:"plate_number",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"]),y.value&&!l.value.car_id?($(),w("small",ba,d(e.$t("field_required")),1)):q("",!0)]),t("div",ga,[t("label",$a,[_(d(e.$t("body_cam")),1),wa]),i(r,{id:"body_cam_id",modelValue:l.value.body_cam_id,"onUpdate:modelValue":o[13]||(o[13]=a=>l.value.body_cam_id=a),options:E.value,label:"comment",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"]),y.value&&!l.value.body_cam_id?($(),w("small",Va,d(e.$t("field_required")),1)):q("",!0)])]),t("div",qa,[t("div",Ca,[t("label",ka,[_(d(e.$t("main_or_additional")),1),Da]),i(r,{id:"main_or_additional",modelValue:l.value.main_or_additional,"onUpdate:modelValue":o[14]||(o[14]=a=>l.value.main_or_additional=a),options:O.value,label:"name",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"]),y.value&&!l.value.main_or_additional?($(),w("small",Ua,d(e.$t("field_required")),1)):q("",!0)]),t("div",Ma,[t("label",Sa,[_(d(e.$t("smena")),1),Ta]),i(r,{id:"smena",modelValue:l.value.smena,"onUpdate:modelValue":o[15]||(o[15]=a=>l.value.smena=a),options:P.value,label:"name",reduce:a=>a.id,placeholder:e.$t("select")},null,8,["modelValue","options","reduce","placeholder"]),y.value&&!l.value.smena?($(),w("small",Ia,d(e.$t("field_required")),1)):q("",!0)])])]),_:1},8,["visible","header"]),i(K,{visible:U.value,"onUpdate:visible":o[18]||(o[18]=a=>U.value=a),style:{width:"450px"},header:e.$t("confirmation"),modal:!0},{footer:u(()=>[i(I,{label:"No",icon:"pi pi-times",text:"",onClick:o[17]||(o[17]=a=>U.value=!1)}),i(I,{label:"Yes",icon:"pi pi-check",text:"",onClick:me})]),default:u(()=>[t("div",Na,[Ba,l.value?($(),w("span",Fa,[_(d(e.$t("are_you_sure_to_delete_this_item"))+" ",1),t("b",null,d(l.value.name),1)])):q("",!0)])]),_:1},8,["visible","header"])])])])}}};export{ja as default};
